---
const currentPath = Astro.url.pathname;
const isRussian = currentPath.startsWith('/ru');
const isGerman = currentPath.startsWith('/de');

// Get the corresponding path in other languages
function getEnglishPath(path: string) {
  if (path.startsWith('/ru')) {
    return path.replace('/ru', '') || '/';
  } else if (path.startsWith('/de')) {
    return path.replace('/de', '') || '/';
  } else {
    return path;
  }
}

function getRussianPath(path: string) {
  if (path.startsWith('/de')) {
    return path.replace('/de', '/ru');
  } else if (path.startsWith('/ru')) {
    return path;
  } else {
    return '/ru' + path;
  }
}

function getGermanPath(path: string) {
  if (path.startsWith('/ru')) {
    return path.replace('/ru', '/de');
  } else if (path.startsWith('/de')) {
    return path;
  } else {
    return '/de' + path;
  }
}

const englishPath = getEnglishPath(currentPath);
const russianPath = getRussianPath(currentPath);
const germanPath = getGermanPath(currentPath);
---

<div class="language-switcher">
  <div class="dropdown">
    <button class="dropdown-toggle" id="language-dropdown">
      {!isRussian && !isGerman ? '🇺🇸 EN' : isRussian ? '🇷🇺 RU' : '🇩🇪 DE'}
      <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
        <path d="M6 8L2 4h8L6 8z"/>
      </svg>
    </button>
    <div class="dropdown-menu" id="language-menu">
      <a 
        href={englishPath} 
        class={`dropdown-item ${!isRussian && !isGerman ? 'active' : ''}`}
        aria-label="Switch to English"
      >
        🇺🇸 English
      </a>
      <a 
        href={russianPath} 
        class={`dropdown-item ${isRussian ? 'active' : ''}`}
        aria-label="Переключить на русский"
      >
        🇷🇺 Русский
      </a>
      <a 
        href={germanPath} 
        class={`dropdown-item ${isGerman ? 'active' : ''}`}
        aria-label="Auf Deutsch wechseln"
      >
        🇩🇪 Deutsch
      </a>
    </div>
  </div>
</div>

<style>
  .language-switcher {
    display: flex;
    align-items: center;
    position: relative;
  }

  .dropdown {
    position: relative;
  }

  .dropdown-toggle {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background: #f3f4f6;
    border-radius: 0.5rem;
    border: none;
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .dropdown-toggle:hover {
    background: #e5e7eb;
  }

  .dropdown-arrow {
    transition: transform 0.2s ease;
  }

  .dropdown.open .dropdown-arrow {
    transform: rotate(180deg);
  }

  .dropdown-menu {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
    min-width: 140px;
    z-index: 50;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.2s ease;
  }

  .dropdown.open .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .dropdown-item {
    display: block;
    padding: 0.75rem 1rem;
    font-size: 0.875rem;
    font-weight: 500;
    text-decoration: none;
    color: #6b7280;
    transition: all 0.2s ease;
    border-radius: 0.375rem;
    margin: 0.25rem;
  }

  .dropdown-item:first-child {
    margin-top: 0.5rem;
  }

  .dropdown-item:last-child {
    margin-bottom: 0.5rem;
  }

  .dropdown-item:hover {
    background: #e5e7eb;
    color: #374151;
  }

  .dropdown-item.active {
    background: #2563eb;
    color: white;
  }

  .dropdown-item.active:hover {
    background: #1d4ed8;
    color: white;
  }

  @media (max-width: 768px) {
    .dropdown-toggle {
      padding: 0.375rem 0.5rem;
      font-size: 0.75rem;
    }

    .dropdown-menu {
      right: -1rem;
      min-width: 120px;
    }

    .dropdown-item {
      padding: 0.5rem 0.75rem;
      font-size: 0.75rem;
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const dropdown = document.querySelector('.dropdown');
    const dropdownToggle = document.getElementById('language-dropdown');
    const dropdownMenu = document.getElementById('language-menu');
    
    if (dropdownToggle && dropdown) {
      dropdownToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdown.classList.toggle('open');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', (e) => {
        if (!dropdown.contains(e.target)) {
          dropdown.classList.remove('open');
        }
      });
      
      // Close dropdown when pressing Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          dropdown.classList.remove('open');
        }
      });
    }
  });
</script>